---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  const tags = [...new Set(posts.flatMap(post => post.data.tags || []))];
  return tags.map(tag => ({ params: { tag } }));
}

const { tag } = Astro.params;
const posts = await getCollection('posts', post => post.data.tags?.includes(tag));

// Tag-specific metadata
const tagMeta = {
  phishing: {
    title: 'Phishing Protection Resources | SMBCyberHub',
    description: 'Learn how to protect your small business from phishing attacks. Practical tips, training materials, and prevention strategies for SMB teams.',
    emoji: 'ğŸ£'
  },
  compliance: {
    title: 'Cybersecurity Compliance Resources | SMBCyberHub',
    description: 'GDPR, ISO27001, and cyber insurance compliance guides for small businesses. Download templates and checklists for audit readiness.',
    emoji: 'ğŸ“‹'
  },
  gdpr: {
    title: 'GDPR Compliance Resources | SMBCyberHub',
    description: 'GDPR Article 39.1(b) compliance for small businesses. Staff training, documentation, and audit requirements explained.',
    emoji: 'ğŸ‡ªğŸ‡º'
  },
  'cyber insurance': {
    title: 'Cyber Insurance Resources | SMBCyberHub',
    description: 'Navigate cyber insurance requirements and audits. Download compliance documentation and training materials for insurance readiness.',
    emoji: 'ğŸ›¡ï¸'
  },
  mfa: {
    title: 'Multi-Factor Authentication (MFA) Resources | SMBCyberHub',
    description: 'Implement MFA for small businesses. Practical guides, employee training, and security best practices for multi-factor authentication.',
    emoji: 'ğŸ”'
  },
  password: {
    title: 'Password Security Resources | SMBCyberHub',
    description: 'Password management and security best practices for small businesses. Employee training and policy templates included.',
    emoji: 'ğŸ”‘'
  },
  'access control': {
    title: 'Access Control Resources | SMBCyberHub',
    description: 'Access management and control for small businesses. Onboarding, offboarding, and access review procedures.',
    emoji: 'ğŸ‘¥'
  },
  offboarding: {
    title: 'Employee Offboarding Resources | SMBCyberHub',
    description: 'Secure employee offboarding procedures for small businesses. Access revocation, data transfer, and documentation.',
    emoji: 'ğŸšª'
  },
  'remote work': {
    title: 'Remote Work Security Resources | SMBCyberHub',
    description: 'Secure remote work practices for small businesses. Home office security, VPN, and remote access management.',
    emoji: 'ğŸ '
  },
  backups: {
    title: 'Data Backup Resources | SMBCyberHub',
    description: 'Data backup and recovery strategies for small businesses. 3-2-1 backup plans and disaster recovery procedures.',
    emoji: 'ğŸ’¾'
  }
};

const meta = tagMeta[tag] || {
  title: `${tag.charAt(0).toUpperCase() + tag.slice(1)} Resources | SMBCyberHub`,
  description: `Browse all ${tag} resources and guides for small business cybersecurity compliance.`,
  emoji: 'ğŸ“š'
};

// Breadcrumb schema
const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://smbcyberhub.com/' },
    { '@type': 'ListItem', position: 2, name: 'Blog', item: 'https://smbcyberhub.com/blog/' },
    { '@type': 'ListItem', position: 3, name: meta.emoji + ' ' + tag.charAt(0).toUpperCase() + tag.slice(1), item: `https://smbcyberhub.com/tags/${tag}/` }
  ]
};
---

<Layout title={meta.title} description={meta.description}>
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)}></script>

  <section class="py-16 px-6 max-w-4xl mx-auto">
    <!-- Breadcrumbs -->
    <nav class="mb-6" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2 text-sm text-gray-600">
        <li><a href="/" class="hover:text-blue-600">Home</a></li>
        <li><span class="mx-2">/</span></li>
        <li><a href="/blog/" class="hover:text-blue-600">Blog</a></li>
        <li><span class="mx-2">/</span></li>
        <li class="text-gray-900 font-medium">{meta.emoji} {tag.charAt(0).toUpperCase() + tag.slice(1)}</li>
      </ol>
    </nav>

    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-blue-900 mb-4">
        {meta.emoji} {tag.charAt(0).toUpperCase() + tag.slice(1)} Resources
      </h1>
      <p class="text-lg text-gray-700 max-w-2xl mx-auto">
        {meta.description}
      </p>
    </div>

    {posts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-gray-600">No posts found for this tag.</p>
        <a href="/blog/" class="text-blue-600 hover:underline mt-4 inline-block">â† Back to Blog</a>
      </div>
    ) : (
      <div class="space-y-6">
        {posts.sort((a, b) => new Date(b.data.date) - new Date(a.data.date)).map(post => (
          <article class="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:border-blue-200 transition">
            <h3 class="text-xl font-semibold text-blue-800 mb-2">
              <a href={`/posts/${post.slug}/`} class="hover:underline">
                {post.data.title}
              </a>
            </h3>
            <p class="text-sm text-gray-600 mb-2">
              {new Date(post.data.date).toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' })}
              {post.data.tags && post.data.tags.length > 0 && (
                <span class="ml-2 text-blue-600">
                  {post.data.tags.slice(0, 3).map(t => `#${t}`).join(' ')}
                </span>
              )}
            </p>
            <p class="text-gray-700 mb-4">{post.data.description}</p>
            <a href={`/posts/${post.slug}/`} class="text-blue-600 hover:text-blue-800 font-medium">
              Read more â†’
            </a>
          </article>
        ))}
      </div>
    )}

    <!-- Tag-specific CTA -->
    <div class="mt-12 p-6 bg-gradient-to-r from-blue-50 to-emerald-50 rounded-xl border border-blue-200">
      <h3 class="text-xl font-bold text-gray-900 mb-3">
        ğŸš€ Get Your Free Cyber Security Training Kit
      </h3>
      <p class="text-gray-700 mb-6">
        Download our comprehensive free sample with {tag === 'phishing' ? 'phishing awareness training' : tag === 'gdpr' ? 'GDPR compliance templates' : 'cybersecurity resources'} and more.
      </p>
      <div class="flex flex-col sm:flex-row gap-4">
        <a href="/free-cyber-security-training/" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-6 py-3 rounded-lg shadow transition">
          ğŸ“¥ Download Free Kit
        </a>
        <a href="/kits/" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg shadow transition">
          ğŸ§° Compare All Kits
        </a>
      </div>
    </div>

    <!-- Related Tags -->
    <div class="mt-8 text-center">
      <p class="text-sm text-gray-600 mb-3">Browse other topics:</p>
      <div class="flex flex-wrap justify-center gap-2">
        {Object.keys(tagMeta).map(relatedTag => (
          relatedTag !== tag && (
            <a href={`/tags/${relatedTag}/`} class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700 transition">
              {tagMeta[relatedTag].emoji} {relatedTag}
            </a>
          )
        ))}
      </div>
    </div>
  </section>
</Layout>
