---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');

// Group posts by category for better navigation
const categorizedPosts = posts.reduce((acc, post) => {
  const tags = post.data.tags || [];
  if (tags.includes('phishing')) {
    acc.phishing.push(post);
  } else if (tags.includes('compliance') || tags.includes('gdpr')) {
    acc.compliance.push(post);
  } else if (tags.includes('password') || tags.includes('mfa')) {
    acc.security.push(post);
  } else if (tags.includes('offboarding') || tags.includes('access control')) {
    acc.management.push(post);
  } else {
    acc.general.push(post);
  }
  return acc;
}, { phishing: [], compliance: [], security: [], management: [], general: [] });

// Featured posts
const featuredPosts = posts.filter(post => post.data.featured).sort((a, b) => new Date(b.data.date) - new Date(a.data.date));
---

<Layout 
  title="Cybersecurity Blog â€“ SMBCyberHub" 
  description="Read the SMBCyberHub blog for the latest tips, news, and practical guides on cybersecurity, compliance, and training for small businesses and teams. Updated 2026."
>
  <section class="py-16 px-6 max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold text-blue-900 mb-6">Cybersecurity Insights & Resources</h1>
    <p class="text-gray-600 mb-10 text-sm">
      Practical cybersecurity tips, compliance guidance, and training insights for small businesses. Updated monthly with actionable advice.
    </p>

    <!-- Quick Navigation -->
    <div class="bg-blue-50 p-6 rounded-lg mb-10">
      <h2 class="text-lg font-semibold text-blue-800 mb-4">ğŸ” Browse by Topic</h2>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <a href="#phishing" class="text-blue-600 hover:text-blue-800 underline">Phishing</a>
        <a href="#compliance" class="text-blue-600 hover:text-blue-800 underline">Compliance</a>
        <a href="#security" class="text-blue-600 hover:text-blue-800 underline">Security</a>
        <a href="#management" class="text-blue-600 hover:text-blue-800 underline">Management</a>
        <a href="#general" class="text-blue-600 hover:text-blue-800 underline">General</a>
      </div>
    </div>

    <!-- Featured Posts -->
    {featuredPosts.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-blue-800 mb-6">â­ Featured Posts</h2>
        <div class="grid gap-6">
          {featuredPosts.map(post => (
            <article class="bg-white p-6 rounded-lg shadow-sm border border-blue-100">
              <h3 class="text-xl font-semibold text-blue-800 mb-2">
                <a href={`/posts/${post.slug}`} class="hover:underline">
                  {post.data.title}
                </a>
              </h3>
              <p class="text-sm text-gray-600 mb-2">
                {new Date(post.data.date).toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' })}
                {post.data.tags && post.data.tags.length > 0 && (
                  <span class="ml-2 text-blue-600">
                    {post.data.tags.slice(0, 3).map(tag => `#${tag}`).join(' ')}
                  </span>
                )}
              </p>
              <p class="text-gray-700">{post.data.description}</p>
            </article>
          ))}
        </div>
      </section>
    )}

    <!-- Categorized Posts -->
    <div class="space-y-12">
      {Object.entries(categorizedPosts).map(([category, categoryPosts]) => (
        categoryPosts.length > 0 && (
          <section id={category}>
            <h2 class="text-2xl font-bold text-blue-800 mb-6 capitalize">
              {category === 'phishing' && 'ğŸ£ Phishing Protection'}
              {category === 'compliance' && 'ğŸ“‹ Compliance & GDPR'}
              {category === 'security' && 'ğŸ” Security Best Practices'}
              {category === 'management' && 'ğŸ‘¥ Team Management'}
              {category === 'general' && 'ğŸ“š General Cybersecurity'}
            </h2>
            <div class="grid gap-6">
              {categoryPosts.sort((a, b) => new Date(b.data.date) - new Date(a.data.date)).map(post => (
                <article class="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:border-blue-200 transition">
                  <h3 class="text-lg font-semibold text-blue-800 mb-2">
                    <a href={`/posts/${post.slug}`} class="hover:underline">
                      {post.data.title}
                    </a>
                  </h3>
                  <p class="text-sm text-gray-600 mb-2">
                    {new Date(post.data.date).toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' })}
                    {post.data.tags && post.data.tags.length > 0 && (
                      <span class="ml-2 text-blue-600">
                        {post.data.tags.slice(0, 3).map(tag => `#${tag}`).join(' ')}
                      </span>
                    )}
                  </p>
                  <p class="text-gray-700">{post.data.description}</p>
                </article>
              ))}
            </div>
          </section>
        )
      ))}
    </div>

    <!-- Call to Action -->
    <section class="bg-emerald-50 p-8 rounded-lg mt-12 text-center">
      <h2 class="text-2xl font-bold text-emerald-800 mb-4">ğŸš€ Get Your Free Cyber Security Training Kit</h2>
      <p class="text-gray-700 mb-6">
        Download our comprehensive free sample with phishing awareness, password hygiene, and compliance checklists.
      </p>
      <a href="/free-cyber-security-training/" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-6 py-3 rounded-lg shadow inline-block">
        ğŸ“¥ Download Free Kit
      </a>
    </section>
  </section>
</Layout>

