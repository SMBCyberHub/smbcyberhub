---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');

// Group posts by category for better navigation
const categorizedPosts = posts.reduce((acc, post) => {
  const tags = post.data.tags || [];
  if (tags.includes('phishing')) {
    acc.phishing.push(post);
  } else if (tags.includes('compliance') || tags.includes('gdpr')) {
    acc.compliance.push(post);
  } else if (tags.includes('password') || tags.includes('mfa')) {
    acc.security.push(post);
  } else if (tags.includes('offboarding') || tags.includes('access control')) {
    acc.management.push(post);
  } else {
    acc.general.push(post);
  }
  return acc;
}, { phishing: [], compliance: [], security: [], management: [], general: [] });

// Featured posts
const featuredPosts = posts.filter(post => post.data.featured).sort((a, b) => new Date(b.data.date) - new Date(a.data.date));

// Sort all posts by date for schema
const allPostsSorted = [...posts].sort((a, b) => new Date(b.data.date) - new Date(a.data.date));

// CollectionPage schema
const collectionSchema = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'Cybersecurity Blog â€“ SMBCyberHub',
  description: 'Practical cybersecurity tips, compliance guides, and training resources for small businesses and teams. Updated 2026.',
  url: 'https://smbcyberhub.com/blog/',
  mainEntity: {
    '@type': 'ItemList',
    numberOfItems: allPostsSorted.length,
    itemListElement: allPostsSorted.slice(0, 20).map((post, i) => ({
      '@type': 'ListItem',
      position: i + 1,
      url: `https://smbcyberhub.com/posts/${post.slug}/`,
      name: post.data.title
    }))
  }
};

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://smbcyberhub.com/' },
    { '@type': 'ListItem', position: 2, name: 'Blog', item: 'https://smbcyberhub.com/blog/' }
  ]
};
---

<Layout 
  title="Cybersecurity Blog â€“ SMBCyberHub" 
  description="SMBCyberHub blog: practical cybersecurity tips, compliance guides, and training resources for small businesses and teams. Updated 2026."
>
  <script type="application/ld+json" set:html={JSON.stringify(collectionSchema)}></script>
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)}></script>
  <section class="py-16 px-6 max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold text-blue-900 mb-6">Cybersecurity Insights & Resources</h1>
    <p class="text-gray-600 mb-10 text-sm">
      Practical cybersecurity tips, compliance guidance, and training insights for small businesses. Updated monthly with actionable advice.
    </p>

    <!-- Featured Guide -->
    <div class="bg-emerald-50 border border-emerald-200 p-6 rounded-lg mb-8">
      <h2 class="text-xl font-bold text-emerald-800 mb-3">ğŸ¯ Featured Guide: SMB Cybersecurity Compliance 2026</h2>
      <p class="text-gray-700 mb-4">Complete GDPR requirements, cyber insurance compliance, audit readiness checklist, and 30-day implementation plan. Download free templates and achieve compliance in 30 minutes.</p>
      <a href="/posts/smb-cybersecurity-compliance-guide-2026/" class="text-emerald-700 font-semibold hover:underline">Read Complete Guide â†’</a>
    </div>

    <!-- Quick Navigation -->
    <div class="bg-blue-50 p-6 rounded-lg mb-10">
      <h2 class="text-lg font-semibold text-blue-800 mb-4">ğŸ” Browse by Topic</h2>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <a href="#phishing" class="text-blue-600 hover:text-blue-800 underline">Phishing</a>
        <a href="#compliance" class="text-blue-600 hover:text-blue-800 underline">Compliance</a>
        <a href="#security" class="text-blue-600 hover:text-blue-800 underline">Security</a>
        <a href="#management" class="text-blue-600 hover:text-blue-800 underline">Management</a>
        <a href="#general" class="text-blue-600 hover:text-blue-800 underline">General</a>
      </div>
    </div>

    <!-- Featured Posts -->
    {featuredPosts.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-blue-800 mb-6">â­ Featured Posts</h2>
        <div class="grid gap-6">
          {featuredPosts.map(post => (
            <article class="bg-white p-6 rounded-lg shadow-sm border border-blue-100">
              <h3 class="text-xl font-semibold text-blue-800 mb-2">
                <a href={`/posts/${post.slug}/`} class="hover:underline">
                  {post.data.title}
                </a>
              </h3>
              <p class="text-sm text-gray-600 mb-2">
                {new Date(post.data.date).toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' })}
                {post.data.tags && post.data.tags.length > 0 && (
                  <span class="ml-2 text-blue-600">
                    {post.data.tags.slice(0, 3).map(tag => `#${tag}`).join(' ')}
                  </span>
                )}
              </p>
              <p class="text-gray-700">{post.data.description}</p>
            </article>
          ))}
        </div>
      </section>
    )}

    <!-- Categorized Posts -->
    <div class="space-y-12">
      {Object.entries(categorizedPosts).map(([category, categoryPosts]) => (
        categoryPosts.length > 0 && (
          <section id={category}>
            <h2 class="text-2xl font-bold text-blue-800 mb-6 capitalize">
              {category === 'phishing' && 'ğŸ£ Phishing Protection'}
              {category === 'compliance' && 'ğŸ“‹ Compliance & GDPR'}
              {category === 'security' && 'ğŸ” Security Best Practices'}
              {category === 'management' && 'ğŸ‘¥ Team Management'}
              {category === 'general' && 'ğŸ“š General Cybersecurity'}
            </h2>
            <div class="grid gap-6">
              {categoryPosts.sort((a, b) => new Date(b.data.date) - new Date(a.data.date)).map(post => (
                <article class="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:border-blue-200 transition">
                  <h3 class="text-lg font-semibold text-blue-800 mb-2">
                    <a href={`/posts/${post.slug}/`} class="hover:underline">
                      {post.data.title}
                    </a>
                  </h3>
                  <p class="text-sm text-gray-600 mb-2">
                    {new Date(post.data.date).toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' })}
                    {post.data.tags && post.data.tags.length > 0 && (
                      <span class="ml-2 text-blue-600">
                        {post.data.tags.slice(0, 3).map(tag => `#${tag}`).join(' ')}
                      </span>
                    )}
                  </p>
                  <p class="text-gray-700">{post.data.description}</p>
                </article>
              ))}
            </div>
          </section>
        )
      ))}
    </div>

    <!-- Social Proof -->
    <section class="bg-gray-50 p-8 rounded-lg mt-12">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Trusted by 100+ Small Businesses</h2>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <p class="text-gray-700 mb-3 italic">"Passed our GDPR audit on the first attempt! The auditor was impressed with our documentation."</p>
          <p class="text-sm text-gray-600">â€” Michael R, Managing Director</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <p class="text-gray-700 mb-3 italic">"Saved us 20+ hours of compliance work. Best investment we made this year."</p>
          <p class="text-sm text-gray-600">â€” Sarah L, Operations Manager</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <p class="text-gray-700 mb-3 italic">"Insurance premiums went down after implementing the training. ROI was immediate."</p>
          <p class="text-sm text-gray-600">â€” David K, Finance Director</p>
        </div>
      </div>
      <div class="text-center mt-6">
        <div class="inline-flex items-center text-yellow-500">
          <span class="text-2xl">â˜…â˜…â˜…â˜…â˜…</span>
          <span class="ml-2 text-gray-600">4.9/5 from 7 reviews</span>
        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="bg-emerald-50 p-8 rounded-lg mt-12 text-center">
      <h2 class="text-2xl font-bold text-emerald-800 mb-4">ğŸš€ Get Your Free Cyber Security Training Kit</h2>
      <p class="text-gray-700 mb-6">
        Download our comprehensive free sample with phishing awareness, password hygiene, and compliance checklists.
      </p>
      <a href="/free-cyber-security-training/" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-6 py-3 rounded-lg shadow inline-block">
        ğŸ“¥ Download Free Kit
      </a>
    </section>
  </section>
</Layout>

